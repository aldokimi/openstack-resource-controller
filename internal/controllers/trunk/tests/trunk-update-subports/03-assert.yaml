---
apiVersion: kuttl.dev/v1beta1
kind: TestAssert
resourceRefs:
    - apiVersion: openstack.k-orc.cloud/v1alpha1
      kind: Trunk
      name: trunk-update-subports
      ref: trunk
    - apiVersion: openstack.k-orc.cloud/v1alpha1
      kind: Port
      name: trunk-update-subports-subport1
      ref: subport1
    - apiVersion: openstack.k-orc.cloud/v1alpha1
      kind: Port
      name: trunk-update-subports-subport2
      ref: subport2
    - apiVersion: openstack.k-orc.cloud/v1alpha1
      kind: Port
      name: trunk-update-subports-subport3
      ref: subport3
assertAll:
    - celExpr: "trunk.status.conditions.exists(c, c.type == 'Available' && c.status == 'True')"
    - celExpr: "trunk.status.resource.subports.size() == 2"
    - celExpr: "trunk.status.resource.subports.exists(s, s.portID == subport1.status.id && s.segmentationID == 150)"
    - celExpr: "trunk.status.resource.subports.exists(s, s.portID == subport3.status.id && s.segmentationID == 300)"
    - celExpr: "!trunk.status.resource.subports.exists(s, s.portID == subport2.status.id)"

